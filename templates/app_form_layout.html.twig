{% extends 'bootstrap_5_layout.html.twig' %}

{# Override des blocks Bootstrap pour les labels #}
{%- block form_label -%}
    {%- if label is not same as(false) -%}
        {%- set label_attr = label_attr|merge({class: (label_attr.class|default('') ~ ' form-label')|trim}) -%}
        {%- if required -%}
            {%- set label_attr = label_attr|merge({class: (label_attr.class ~ ' required')|trim}) -%}
        {%- endif -%}
        {%- if parent_label_class is defined -%}
            {%- set label_attr = label_attr|merge({class: (label_attr.class ~ ' ' ~ parent_label_class)|trim}) -%}
        {%- endif -%}
        {%- if label is empty -%}
            {%- if label_format is not empty -%}
                {%- set label = label_format|replace({
                    '%name%': name,
                    '%id%': id,
                }) -%}
            {%- else -%}
                {%- set label = name|humanize -%}
            {%- endif -%}
        {%- endif -%}
        <{{ element|default('label') }}{% if label_attr %}{% with { attr: label_attr } %}{{ block('attributes') }}{% endwith %}{% endif %}>
        {%- if translation_domain is same as(false) -%}
            {{- label -}}
        {%- else -%}
            {{- label|trans(label_translation_parameters, translation_domain) -}}
        {%- endif -%}
        </{{ element|default('label') }}>
    {%- endif -%}
{%- endblock form_label -%}

{# Override pour les lignes de formulaire horizontales sans col-sm-2 #}
{%- block form_row -%}
    {%- if 'form-floating' in row_attr.class|default('') -%}
        {{- block('form_row_floating') -}}
    {%- else -%}
        <div{% with {attr: row_attr} %}{{ block('attributes') }}{% endwith %}>
            {{- form_label(form) -}}
            {{- form_widget(form) -}}
            {{- form_help(form) -}}
            {{- form_errors(form) -}}
        </div>
    {%- endif -%}
{%- endblock form_row -%}

{# Widget for radio buttons as Bootstrap button group #}
{%- block choice_widget_expanded -%}
    {%- if 'btn-group' in attr.class|default('') -%}
        <div {{ block('widget_container_attributes') }}>
            {%- for child in form %}
                <input type="radio" class="btn-check" name="{{ full_name }}" id="{{ child.vars.id }}" value="{{ child.vars.value }}"{{ child.vars.checked ? ' checked' : '' }}{% if required %} required{% endif %}>
                <label class="btn btn-outline-primary" for="{{ child.vars.id }}">
                    {{- child.vars.label|trans({}, translation_domain) -}}
                </label>
            {%- endfor %}
        </div>
    {%- else -%}
        {{- parent() -}}
    {%- endif -%}
{%- endblock choice_widget_expanded -%}

{# Widget pour les participations aux événements #}
{%- block _event_participation_participationState_widget -%}
    <div class="btn-group mb-3" role="group">
        {%- for child in form %}
            {% set widget_value = child.vars.value %}
            {% set color = 'secondary' %}
            {% set label = widget_value|readable_enum %}
            {% if widget_value is same as constant('App\\DBAL\\Types\\EventParticipationStateType::NOT_GOING') %}
                {% set color = 'danger' %}
                {% set label = 'Je n\'y vais pas' %}
            {% elseif widget_value is same as constant('App\\DBAL\\Types\\EventParticipationStateType::INTERESTED') %}
                {% set color = 'warning' %}
                {% set label = 'Je souhaite y aller' %}
            {% elseif widget_value is same as constant('App\\DBAL\\Types\\EventParticipationStateType::REGISTERED') %}
                {% set color = 'success' %}
                {% set label = 'Je suis inscrit' %}
            {% endif %}
            <input type="radio"
                   class="btn-check"
                   name="{{ form.vars.full_name }}"
                   id="{{ child.vars.id }}"
                   value="{{ widget_value }}"
                   autocomplete="off"
                   {% if value is same as widget_value %}checked{% endif %}
            >
            <label class="btn btn-outline-{{ color }}"
                   for="{{ child.vars.id }}">
                {{ label }}
            </label>
        {% endfor -%}
    </div>
{%- endblock _event_participation_participationState_widget %}
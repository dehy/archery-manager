{# Reusable participation modal for events #}
{# Parameters: event, event_participation_form #}

{% set isContest = event is instanceof('App\\Entity\\ContestEvent') or event is instanceof('App\\Entity\\HobbyContestEvent') %}

<div class="modal fade" id="participationModal" tabindex="-1" aria-labelledby="participationModalLabel" aria-hidden="true">
    <div class="modal-dialog {{ isContest ? 'modal-lg' : 'modal-dialog-centered' }}">
        <div class="modal-content border-0 shadow">
            {% if isContest %}
                {% form_theme event_participation_form 'bootstrap_5_layout.html.twig' %}
            {% endif %}
            {{ form_start(event_participation_form) }}
            
            <div class="modal-header {{ isContest ? 'bg-primary bg-gradient text-white' : 'border-0 pb-0' }}">
                <h5 class="modal-title" id="participationModalLabel">
                    <i class="fa-solid fa-user-check {{ isContest ? 'me-2' : 'text-primary me-2' }}"></i>
                    Ma participation
                </h5>
                <button type="button" class="btn-close {{ isContest ? 'btn-close-white' : '' }}" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body {{ isContest ? 'p-4' : 'pt-0' }}">
                {% if isContest %}
                    <div class="alert alert-info border-0 bg-light">
                        <i class="fa-solid fa-info-circle me-2"></i>
                        <strong>{{ event.title }}</strong>
                    </div>
                {% else %}
                    <p class="text-muted mb-4">
                        Confirme ta participation au {{ event.title[:1]|lower ~ event.title[1:] }}
                    </p>
                {% endif %}
                
                <div class="{{ isContest ? 'row g-4' : '' }}">
                    <div class="{{ isContest ? 'col-12' : 'participation-options mb-4' }}">
                        {% if isContest %}
                            <label class="form-label fw-bold">État de ma participation</label>
                        {% endif %}
                        {{ form_widget(event_participation_form.participationState, {
                            'attr': {'class': 'form-check-input-lg'}
                        }) }}
                    </div>
                    
                    {# Activity field - shown for all event types #}
                    <div class="{{ isContest ? 'col-12' : 'mb-3' }}">
                        <div class="{{ isContest ? 'mb-3' : '' }}">
                            <label class="form-label fw-bold">
                                <i class="fa-solid fa-bullseye text-primary me-2"></i>
                                Activité
                            </label>
                            {{ form_widget(event_participation_form.activity, {
                                'attr': {'class': isContest ? 'form-select form-select-lg' : 'form-select'}
                            }) }}
                            {{ form_errors(event_participation_form.activity) }}
                        </div>
                    </div>
                    
                    {% if isContest %}
                        {% if event_participation_form.targetType is defined %}
                            <div class="col-md-6">
                                {{ form_row(event_participation_form.targetType) }}
                            </div>
                        {% endif %}
                    
                        {% if event_participation_form.departure is defined %}
                            <div class="col-12">
                                {{ form_row(event_participation_form.departure) }}
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
                
                {% if isContest %}
                    <div class="alert alert-warning border-0 bg-warning bg-opacity-10 mt-4">
                        <div class="d-flex">
                            <i class="fa-solid fa-exclamation-triangle text-warning me-3 mt-1"></i>
                            <div>
                                <strong>Important !</strong><br>
                                C'est à vous de vous inscrire personnellement au concours selon les modalités inscrites
                                dans le mandat. Cet outil est seulement là pour se tenir au courant entre archers du club !
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
            
            <div class="modal-footer {{ isContest ? 'border-0 bg-light' : 'border-0 pt-0' }}">
                <button type="button" class="btn {{ isContest ? 'btn-secondary' : 'btn-outline-secondary' }}" data-bs-dismiss="modal">
                    <i class="fa-solid fa-times me-1"></i>
                    Annuler
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fa-solid fa-save me-1"></i>
                    {{ isContest ? 'Enregistrer ma participation' : 'Enregistrer' }}
                </button>
            </div>
            
            {{ form_end(event_participation_form) }}
        </div>
    </div>
</div>
